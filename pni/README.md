# Python interface for Game of Life

Python wrapper for C implementation of Conway's Game of Life algorithm.

This only provides low-level utilities. It is intended to be used as a dependency for higher-level
pure Python packages; as of this update, they are:

<table>
  <tr>
    <td><A href="https://pypi.org/project/life-web-ui/">life-web-ui</A></td>
    <td>Web UI for Conway Game of Life</td>
  </tr>
</table>

## Installation

Use PyPi package [conway-life](https://pypi.org/project/conway-life/)

```bash
python3 -m pip install --upgrade conway-life
```

## API

#### run(width, height, n_threads, n_iters, pos_start, pos_end, calllback)

`width`:      Width of the board; *integer*<br>
`height`:     Height of the board; *integer*<br>
`n_threads`:  Number of worker threads (not yet supported); *integer*<br>
`n_iters`:    Number of iterations to run; *integer*<br>
`pos_start`:  Initial position; boolean *list* of size `width` x `height`<br>
`pos_end`:    (Output) Final position; boolean *list* of size `width` x `height`. Must be pre-allocated.<br>
`callback`:   Iteration calllback, or `None` (see below)<br>

return value: number of actually executed iterations
          (never more than `n_iters`, but could be less, see below)<br>

**callback(n_iter, count, bhash, pos_ptr, fin)**

`n_iter`:     current iteration (see below); *integer*<br>
`count`:      count of cells; *integer*<br>
`bhash`:      hash of current position; *integer*<br>
`pos_ptr`:    internal memory pointer to the current position; *integer*.
                Method `read_ptr` can be used to extract the position<br>
`fin`:        1 if this is final iteration, 0 if not<br>

return value: `None` or *integer*; value 1 will trigger iterations to stop immediately.<br>

Notes

  1. `callback` (if defined) is called *before* first iteration, and then
again *after* every iterations, including the last (where fin=1). Therefore,
*normally* callback method is called `1 + n_iters` times.

  1. However this method also detects loops and if your sequence deteriorates
to a loop, it will cut it short; `fin` would still be set to 1 on the last
iteration only regardless. Hash values used in loop detection is passed
to the callback.

#### read_ptr(width, height, pos_ptr, position)

`width`:      Width of the board; *integer*<br>
`height`:     Height of the board; *integer*<br>
`pos_ptr`:    Internal memory pointer returned in a callback (see method `run`); *integer*<br>
`position`:   (Output) Intermediary position; boolean *list* of size `width` x `height`.
                Must be pre-allocated.<br>

return value: 1 on success

## Implementation notes

None of the methods allocate any Python objects; output objects must be created by caller.
This both simplifies memory management and makes it possible to avoid unneeded
garbage collection for large objects.

## Development

To generate Python documentation strings in `C` from text file [pydoc.txt](https://github.com/kign/life/blob/master/pni/pydoc.txt), we are using this `node` script:

```javascript
#! /usr/bin/env node
'use strict';

const fs = require('fs');
const file_in = 'pydoc.txt';
const file_out = file_in.replace(/\.[a-z]+$/, '') + '.h';

const doc = fs.readFileSync(file_in, {encoding:'utf8', flag:'r'});

const res = ['/* This file is autogenerated with make_pydoc_h */', ''];

doc.split(/^(?=\[)/m).forEach(s => {
  const m = s.match(/^\[([a-z_][a-z0-9_]*)\]\s*$/mi);
  if (!m) return;
  const fname = m[1];
  const fdoc = s.substr(m[0].length).trim();
  res.push(`#define M_${fname.toUpperCase()} "${fname}"`);
  res.push(`#define ${fname.toUpperCase()}_DOC ${fdoc.
    replace(/\\/g, '\\\\').
    replace(/"/g, '\\"').
    split('\n').
    map(x => `"${x}\\n"`).
    join(' \\\n')
  }`);
  res.push('')

});

fs.writeFileSync(file_out, res.join('\n') + '\n');

console.log("Created file", file_out);
```

To generate distributable packages,

```bash
rm -rf dist build && python3 -m build
```

Note that binary packages (`wheel`) made on Linux cannot be uploaded to PyPi. See [PEP 513](https://www.python.org/dev/peps/pep-0513/) and [manylinux](https://github.com/pypa/manylinux).
